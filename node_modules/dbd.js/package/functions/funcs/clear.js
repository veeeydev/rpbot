module.exports = async d => {
    const code = d.command.code

    const r = code.split("$clear[").length - 1

    const inside = code.split("$clear[")[r].split("]")[0]

    const [
        amount,
        filter = "everyone",
        channelID = d.message.channel.id
    ] = inside.split(";")

    const channel = d.message.guild.channels.cache.get(channelID)

    if (!channel) return d.error(`:x: Invalid channel ID in \`$clear[${inside}]\``)

    if (filter === "everyone" && Number(amount) > 100) {
        //clear handler 
        let input = Number(amount) 
        
        let requests = [] 
        
        new Array(Math.trunc(input / 100) + 1).fill(0).map(() => {
            let data = input - 100 < 1 ? input : 100 
            
            input -= data 
            
            requests.push(data)
        })
        
        for (const AMOUNT of requests) {
            const deleted = await channel.bulkDelete(AMOUNT).catch(err => null) 
            
            if (!deleted) return d.error(`❌ Failed to delete messages`) 
        }
        
        return {
            code: code.replaceLast(`$clear[${inside}]`, "")
        }
    }
    
    const messages = await channel.messages.fetch({
        limit: Number(amount),
        cache: false
    }).catch(err => null)

    if (!messages) return d.error(`:x: Failed to fetch messages!`)

    const deleted = await channel.bulkDelete(messages.filter(m => filter === "everyone" ? true : filter === m.author.id).map(m => m.id)).catch(Err => null)

    if (!deleted) return d.error(`:x: Failed to delete messages!`)

    return {
        code: code.replaceLast(`$clear[${inside}]`, "")
    }

}