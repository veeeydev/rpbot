const axios = require("axios") 
const fetch = require("node-fetch") 
const embed = require("../../handlers/errors")
module.exports = async d => {
    const code = d.command.code 
    
    const r = code.split(`$reply`).length - 1 
    
    const inside = code.split(`$reply[`)[r].split("]")[0] 
    
    const [messageID, msg, mention = "yes"] = inside.split(";") 
    
    const m = await embed(d, msg, true) 
    
    const request = await fetch(`https://discordapp.com/api/channels/${d.message.channel.id}/messages`, {
        method: "POST", 
        headers: {
            "content-type": "application/json", 
            Authorization: `Bot ${d.client.token}`
        }, 
        body: JSON.stringify({
            "content": m.message || "", 
            "embed": m.embed || undefined, 
            "message_reference": {
                "message_id": messageID
            }, 
            "allowed_mentions": {
                "replied_user": mention === "yes" 
            }
        }) 
    }) 
    
    return {
        code: code.replaceLast(`$reply[${inside}]`, "")
    }
}