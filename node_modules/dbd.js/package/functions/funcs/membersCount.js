module.exports = d => {

  const code = d.command.code

  const r = code.split("$membersCount").length - 1

  const after = code.split("$membersCount")[r]

  if (after.startsWith("[")) {
    const inside = after.slice(1).split("]")[0]

    const options = [
      guildID = d.message.guild.id,
      presence = "all",
      countBots = "yes"
    ] = inside.split(";")

    const guild = d.client.guilds.cache.get(guildID || d.message.guild.id) 

    if (!guild) return d.error(`:x: Invalid guild ID in \`$membersCount[${inside}]\``)

    return {
      code: code.replaceLast(`$membersCount[${inside}]`, guild.members.cache.filter(m => countBots === "yes" ? true : m.user.bot === false).filter(m => presence === "all" ? true : presence.toLowerCase() === m.presence.status).size)
    }
  } else {
    return {
      code: d.command.code.replaceLast("$membersCount", d.message.guild.memberCount)
    } 
  }
}
