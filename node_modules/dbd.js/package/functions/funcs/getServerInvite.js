module.exports = async d => {
    const code = d.command.code

    const r = code.split("$getServerInvite").length - 1

    const after = code.split("$getServerInvite")[r]

    if (after[0] === "[") {
        const guildID = after.slice(1).split("]")[0]

        const guild = d.client.guilds.cache.get(guildID)

        if (!guild) return d.error(`:x: Invalid guild ID in \`$getServerInvite[${guildID}]\``)

        const channel = guild.channels.cache.find(ch => ch.type === "text" && ch.permissionsFor(d.client.user.id).has("CREATE_INSTANT_INVITE"))

        let invite

        if (channel) invite = await channel.createInvite().catch(Err => {})

        return {
            code: code.replaceLast(`$getServerInvite[${guildID}]`, invite ? invite.toString() : "missing permissions")   
        }
    } else {
        const channel = d.message.guild.channels.cache.find(ch => ch.type === "text" && ch.permissionsFor(d.client.user.id).has("CREATE_INSTANT_INVITE"))

        let invite 

        if (channel) invite = await channel.createInvite().catch(Err => {})

        return {
            code: code.replaceLast(`$getServerInvite`, invite ? invite.toString() : "missing permissions")   
        }
    }
}