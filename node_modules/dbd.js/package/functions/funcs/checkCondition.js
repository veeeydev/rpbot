
const checkCondition = async d =>{

    const code = d.command.code

    const r = code.split("$checkCondition[").length - 1

    const inside = code.split("$checkCondition[")[r].split("]")[0]

    const p = inside.split(";")
    
    const condition = p.shift()
    
    const operators = () => {
        for (const op of ["<=", ">=", "==", "!=", "<", ">"]) {
            if (condition.includes(op)) return op
        }
    }

    const op = operators()

    if (!operators) return d.error(`:x: No valid operator in \`$checkCondition[${inside}]\``)

    const fields = condition.split(op)

    let pass = true 
    
    if (op === "<=") {
        if (Number(fields[0]) > Number(fields[1])) pass = false
    } else if (op === ">=") {
        if (Number(fields[0]) < Number(fields[1])) pass = false
    } else if (op === "==") {
        if (fields[0].addBrackets() !== fields[1].addBrackets())  pass = false
    } else if (op === "<") {
        if (Number(fields[0]) >= Number(fields[1])) pass = false
    } else if (op === ">") {
        if (Number(fields[0]) <= Number(fields[1])) pass = false
    } else if (op === "!=") {
        if (fields[0].addBrackets() === fields[1].addBrackets()) pass = false
    }

    return {
        code: code.replaceLast(`$checkCondition[${inside}]`, pass)
    }
}

module.exports = checkCondition